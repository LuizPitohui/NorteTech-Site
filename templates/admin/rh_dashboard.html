{% extends "admin/index.html" %}
{% load static %}

{% block content %}
<style>
    .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 5px solid #0d6efd; }
    .stat-number { font-size: 2rem; font-weight: bold; color: #333; }
    .stat-label { color: #666; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
    
    .funnel-container { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 30px; }
    .progress-stacked { display: flex; height: 30px; border-radius: 15px; overflow: hidden; margin-top: 15px; }
    .bar-segment { display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.8rem; }
</style>

<div style="padding: 20px;">
    
    <h1 style="margin-bottom: 20px;">Visão Geral do RH</h1>

    <div class="dashboard-grid">
        <div class="stat-card" style="border-left-color: #28a745;">
            <div class="stat-number">{{ metricas.vagas_abertas }}</div>
            <div class="stat-label">Vagas Abertas</div>
        </div>
        <div class="stat-card" style="border-left-color: #ffc107;">
            <div class="stat-number">{{ metricas.banco_talentos }}</div>
            <div class="stat-label">Banco de Talentos</div>
        </div>
        <div class="stat-card" style="border-left-color: #17a2b8;">
            <div class="stat-number">{{ metricas.total_candidatos }}</div>
            <div class="stat-label">Total de Candidatos</div>
        </div>
        <div class="stat-card" style="border-left-color: #dc3545;">
            <div class="stat-number">{{ metricas.funil.contratados }}</div>
            <div class="stat-label">Contratações</div>
        </div>
    </div>

    <div class="funnel-container">
        <h2>Funil de Recrutamento Ativo</h2>
        <p class="help">Distribuição dos candidatos pelas etapas do processo.</p>
        
        <div class="progress-stacked">
            <div class="bar-segment" style="width: 40%; background-color: #6c757d;" title="Novos: {{ metricas.funil.novos }}">
                Novos ({{ metricas.funil.novos }})
            </div>
            <div class="bar-segment" style="width: 30%; background-color: #0d6efd;" title="Entrevista: {{ metricas.funil.entrevista }}">
                Entrevista ({{ metricas.funil.entrevista }})
            </div>
            <div class="bar-segment" style="width: 20%; background-color: #fd7e14;" title="Admissão: {{ metricas.funil.admissao }}">
                Admissão ({{ metricas.funil.admissao }})
            </div>
            <div class="bar-segment" style="width: 10%; background-color: #198754;" title="Contratados: {{ metricas.funil.contratados }}">
                ★ {{ metricas.funil.contratados }}
            </div>
        </div>
    </div>

    <div class="funnel-container">
        <h2>Vagas Mais Concorridas</h2>
        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <thead>
                <tr style="border-bottom: 2px solid #eee; text-align: left;">
                    <th style="padding: 10px;">Vaga</th>
                    <th style="padding: 10px;">Departamento</th>
                    <th style="padding: 10px;">Candidatos</th>
                    <th style="padding: 10px;">Ação</th>
                </tr>
            </thead>
            <tbody>
                {% for vaga in metricas.top_vagas %}
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px; font-weight: bold;">{{ vaga.title }}</td>
                    <td style="padding: 10px;">{{ vaga.get_department_display }}</td>
                    <td style="padding: 10px;">
                        <span style="background: #e9ecef; padding: 4px 8px; border-radius: 4px;">{{ vaga.num_cand }}</span>
                    </td>
                    <td style="padding: 10px;">
                        <a href="/rh/careers/candidate/?job__id__exact={{ vaga.id }}">Ver Lista</a>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="4" style="padding: 20px; text-align: center;">Nenhuma vaga com candidatos ainda.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

</div>

{{ block.super }}

{% endblock %}